<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Stochastic models ¬∑ StochasticPrograms.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>StochasticPrograms.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../">Home</a></li><li><span class="toctext">Manual</span><ul><li><a class="toctext" href="../quickstart/">Quick start</a></li><li><a class="toctext" href="../data/">Stochastic data</a></li><li class="current"><a class="toctext" href>Stochastic models</a><ul class="internal"><li><a class="toctext" href="#Model-objects-1">Model objects</a></li><li><a class="toctext" href="#Deferred-models-1">Deferred models</a></li></ul></li><li><a class="toctext" href="../distributed/">Distributed stochastic programs</a></li><li><a class="toctext" href="../structuredsolvers/">Structured solvers</a></li><li><a class="toctext" href="../examples/">Examples</a></li></ul></li><li><span class="toctext">Library</span><ul><li><a class="toctext" href="../../library/public/">Public interface</a></li><li><a class="toctext" href="../../library/solverinterface/">Solver interface</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>Manual</li><li><a href>Stochastic models</a></li></ul><a class="edit-page" href="https://github.com/martinbiel/StochasticPrograms.jl/blob/master/docs/src/manual/modeldef.md"><span class="fa">ÔÇõ</span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Stochastic models</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Stochastic-models-1" href="#Stochastic-models-1">Stochastic models</a></h1><p>Now, tools related to model definitions in StochasticPrograms are introduced in more detail.</p><h2><a class="nav-anchor" id="Model-objects-1" href="#Model-objects-1">Model objects</a></h2><p>To further seperate model design from data design, StochasticPrograms provides a stochastic model object. This object can be used to store the optimization models before introducing scenario data. Consider the following alternative approach to the simple problem introduced in the <a href="../quickstart/#Quick-start-1">Quick start</a>:</p><pre><code class="language-julia">using StochasticPrograms

simple_model = StochasticModel((sp) -&gt; begin
	@first_stage sp = begin
		@variable(model, x‚ÇÅ &gt;= 40)
		@variable(model, x‚ÇÇ &gt;= 20)
		@objective(model, Min, 100*x‚ÇÅ + 150*x‚ÇÇ)
		@constraint(model, x‚ÇÅ + x‚ÇÇ &lt;= 120)
	end
	@second_stage sp = begin
		@decision x‚ÇÅ x‚ÇÇ
		Œæ = scenario
		@variable(model, 0 &lt;= y‚ÇÅ &lt;= Œæ.d‚ÇÅ)
		@variable(model, 0 &lt;= y‚ÇÇ &lt;= Œæ.d‚ÇÇ)
		@objective(model, Min, Œæ.q‚ÇÅ*y‚ÇÅ + Œæ.q‚ÇÇ*y‚ÇÇ)
		@constraint(model, 6*y‚ÇÅ + 10*y‚ÇÇ &lt;= 60*x‚ÇÅ)
		@constraint(model, 8*y‚ÇÅ + 5*y‚ÇÇ &lt;= 80*x‚ÇÇ)
	end
end)</code></pre><pre><code class="language-none">Stochastic Model

minimize c·µÄx + ùîº[Q(x,Œæ)]
  x‚àà‚Ñù‚Åø  Ax = b
         x ‚â• 0

where

Q(x,Œæ) = min  q(Œæ)·µÄy
        y‚àà‚Ñù·µê T(Œæ)x + Wy = h(Œæ)
              y ‚â• 0
</code></pre><p>The resulting model object can be used to <a href="../../library/public/#StochasticPrograms.instantiate-Tuple{StochasticModel,Any,Any,Array{#s31,1} where #s31&lt;:AbstractScenario}"><code>instantiate</code></a> different stochastic programs as long as the corresponding scenario data conforms to the second stage model. For example, lets introduce a similar scenario type and use it to construct the same stochastic program as in the <a href="../quickstart/#Quick-start-1">Quick start</a>:</p><pre><code class="language-julia">@scenario AnotherSimple = begin
    q‚ÇÅ::Float64
    q‚ÇÇ::Float64
    d‚ÇÅ::Float64
    d‚ÇÇ::Float64
end

Œæ‚ÇÅ = AnotherSimpleScenario(-24.0, -28.0, 500.0, 100.0, probability = 0.4)
Œæ‚ÇÇ = AnotherSimpleScenario(-28.0, -32.0, 300.0, 300.0, probability = 0.6)

sp = instantiate(simple_model, [Œæ‚ÇÅ, Œæ‚ÇÇ])</code></pre><pre><code class="language-none">Stochastic program with:
 * 2 scenarios of type AnotherSimpleScenario
 * 2 decision variables
 * 2 recourse variables
Solver is default solver</code></pre><p>Moreoever, <a href="../../library/public/#StochasticPrograms.SAA-Union{Tuple{S}, Tuple{D‚ÇÇ}, Tuple{D‚ÇÅ}, Tuple{StochasticProgram{D‚ÇÅ,D‚ÇÇ,S,SP} where SP&lt;:AbstractScenarioProblems{D‚ÇÇ,S},AbstractSampler{S},Integer}} where S&lt;:AbstractScenario where D‚ÇÇ where D‚ÇÅ"><code>SAA</code></a> models are constructed in a straightforward way. Consider the following:</p><pre><code class="language-julia">@sampler AnotherSimple = begin
    @sample begin
        return AnotherSimpleScenario(-24.0 + 2*(2*rand()-1),
                                     -28.0 + (2*rand()-1),
                                     300.0 + 100*(2*rand()-1),
                                     300.0 + 100*(2*rand()-1),
                                     probability = rand())
    end
end

saa = SAA(simple_model, AnotherSimpleSampler(), 10)</code></pre><pre><code class="language-none">Stochastic program with:
 * 10 scenarios of type AnotherSimpleScenario
 * 2 decision variables
 * 2 recourse variables
Solver is default solver</code></pre><p>This allows the user to clearly distinguish between the often abstract <em>base-model</em>:</p><div>\[\DeclareMathOperator*{\minimize}{minimize}
\begin{aligned}
 \minimize_{x \in \mathbb{R}^n} &amp; \quad c^T x + \operatorname{\mathbb{E}}_{\omega} \left[Q(x,\xi(\omega))\right] \\
 \text{s.t.} &amp; \quad Ax = b \\
 &amp; \quad x \geq 0
\end{aligned}\]</div><p>and <em>look-ahead</em> models that approximate the base-model:</p><div>\[\DeclareMathOperator*{\minimize}{minimize}
\begin{aligned}
 \minimize_{x \in \mathbb{R}^n, y_s \in \mathbb{R}^m} &amp; \quad c^T x + \sum_{s = 1}^n \pi_s q_s^Ty_s \\
 \text{s.t.} &amp; \quad Ax = b \\
 &amp; \quad T_s x + W y_s = h_s, \quad &amp;s = 1, \dots, n \\
 &amp; \quad x \geq 0, y_s \geq 0, \quad &amp;s = 1, \dots, n
\end{aligned}\]</div><h2><a class="nav-anchor" id="Deferred-models-1" href="#Deferred-models-1">Deferred models</a></h2><p>Another tool StochasticPrograms is deferred model instantiation. Consider again the simple problem introduced in the <a href="../quickstart/#Quick-start-1">Quick start</a>, but with some slight differences:</p><pre><code class="language-julia">using StochasticPrograms

@scenario Simple = begin
    q‚ÇÅ::Float64
    q‚ÇÇ::Float64
    d‚ÇÅ::Float64
    d‚ÇÇ::Float64
end

sp = StochasticProgram(SimpleScenario)

@first_stage sp = begin
    @variable(model, x‚ÇÅ &gt;= 40)
    @variable(model, x‚ÇÇ &gt;= 20)
    @objective(model, Min, 100*x‚ÇÅ + 150*x‚ÇÇ)
    @constraint(model, x‚ÇÅ + x‚ÇÇ &lt;= 120)
end defer

@second_stage sp = begin
    @decision x‚ÇÅ x‚ÇÇ
    Œæ = scenario
    @variable(model, 0 &lt;= y‚ÇÅ &lt;= Œæ.d‚ÇÅ)
    @variable(model, 0 &lt;= y‚ÇÇ &lt;= Œæ.d‚ÇÇ)
    @objective(model, Min, Œæ.q‚ÇÅ*y‚ÇÅ + Œæ.q‚ÇÇ*y‚ÇÇ)
    @constraint(model, 6*y‚ÇÅ + 10*y‚ÇÇ &lt;= 60*x‚ÇÅ)
    @constraint(model, 8*y‚ÇÅ + 5*y‚ÇÇ &lt;= 80*x‚ÇÇ)
end</code></pre><pre><code class="language-none">Stochastic program with:
 * 0 scenarios of type SimpleScenario
 * deferred first stage
 * 0 recourse variables
Solver is default solver</code></pre><p>There are two things to note here. First, no scenarios have been loaded yet, so no second stage models were instansiated. Moreover, the first stage was defined with the <code>defer</code> keyword, and the printout states that the first stage is deferred. This means that the first stage model has not yet been instansiated, but the stochastic program instance has a model recipe that can be used to generate it when required:</p><pre><code class="language-julia">println(has_generator(sp, :stage_1))
println(has_generator(sp, :stage_2))</code></pre><pre><code class="language-none">true
true</code></pre><p>Now, we add the simple scenarios to the stochastic program instance, also with a defer keyword:</p><pre><code class="language-julia">Œæ‚ÇÅ = SimpleScenario(-24.0, -28.0, 500.0, 100.0, probability = 0.4)
Œæ‚ÇÇ = SimpleScenario(-28.0, -32.0, 300.0, 300.0, probability = 0.6)
add_scenarios!(sp, [Œæ‚ÇÅ, Œæ‚ÇÇ], defer = true)</code></pre><pre><code class="language-none">Stochastic program with:
 * 2 scenarios of type SimpleScenario
 * deferred first stage
 * deferred second stage
Solver is default solver</code></pre><p>The two scenarios are loaded, but no second stage models were instansiated. Deferred stochastic programs will always be generated in full when required. For instance, this occurs when calling <a href="../../library/public/#StochasticPrograms.optimize!-Tuple{StochasticProgram}"><code>optimize!</code></a>. Furthermore, we can explicitly instansiate the stochastic program using <a href="../../library/public/#StochasticPrograms.generate!-Tuple{StochasticProgram}"><code>generate!</code></a>:</p><pre><code class="language-julia">generate!(sp)</code></pre><pre><code class="language-none">Stochastic program with:
 * 2 scenarios of type SimpleScenario
 * 2 decision variables
 * 2 recourse variables
Solver is default solver</code></pre><footer><hr/><a class="previous" href="../data/"><span class="direction">Previous</span><span class="title">Stochastic data</span></a><a class="next" href="../distributed/"><span class="direction">Next</span><span class="title">Distributed stochastic programs</span></a></footer></article></body></html>
